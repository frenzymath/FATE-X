import Mathlib

namespace Problem75

open IsLocalRing ModuleCat CategoryTheory Problem75

section

variable {R : Type} [CommRing R]

instance : CategoryTheory.HasExt.{0} (ModuleCat.{0} R) :=
  CategoryTheory.hasExt_of_enoughProjectives (ModuleCat R)

noncomputable def moduleDepth (N M : ModuleCat.{0} R) : â„•âˆž :=
  sSup {n : â„•âˆž | âˆ€ i : â„•, i < n â†’ Subsingleton (CategoryTheory.Abelian.Ext.{0} N M i)}

noncomputable def Ideal.depth (I : Ideal R) (M : ModuleCat.{0} R) : â„•âˆž :=
  moduleDepth (ModuleCat.of R (R â§¸ I)) M

noncomputable def IsLocalRing.depth [IsLocalRing R] (M : ModuleCat.{0} R) : â„•âˆž :=
  (IsLocalRing.maximalIdeal R).depth M

variable (R)

class IsCohenMacaulayLocalRing : Prop extends IsLocalRing R where
  depth_eq_dim : ringKrullDim R = IsLocalRing.depth (ModuleCat.of R R)

class IsCohenMacaulayRing : Prop where
  CM_localize : âˆ€ p : Ideal R, âˆ€ (_ : p.IsPrime), IsCohenMacaulayLocalRing (Localization.AtPrime p)

end

/--
Let $A$ be a graded Noetherian ring, with $A_0$ a field and $A$ generated by $A_1$.
Show that $A$ is Cohen-Macaulay if and only if for all homogeneously prime $\mathfrak{p}$,
$(A_{\mathfrak{p}})_0$ is Cohen-Macaulay.
-/
theorem gradedAlgebra_isCohenMacaulay_iff_homogeneously_localize {A : Type} [CommRing A] [IsNoetherianRing A]
    (ð’œ : â„• â†’ Submodule â„¤ A) [GradedAlgebra ð’œ] (h : IsField (ð’œ 0)) (h1 : Algebra.adjoin (ð’œ 0) (ð’œ 1) = (âŠ¤ : Subalgebra (ð’œ 0) A)) : IsCohenMacaulayRing A â†”
    âˆ€ p : Ideal A, (_ : p.IsPrime) â†’ p.IsHomogeneous ð’œ â†’
    IsCohenMacaulayLocalRing (HomogeneousLocalization.AtPrime ð’œ p) := by
  sorry

end Problem75
